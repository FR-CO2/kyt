!function e(t,r,o){function n(l,s){if(!r[l]){if(!t[l]){var i="function"==typeof require&&require;if(!s&&i)return i(l,!0);if(a)return a(l,!0);var c=new Error("Cannot find module '"+l+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[l]={exports:{}};t[l][0].call(u.exports,function(e){var r=t[l][1][e];return n(r?r:e)},u,u.exports,e,t,r,o)}return r[l].exports}for(var a="function"==typeof require&&require,l=0;l<o.length;l++)n(o[l]);return n}({1:[function(e,t,r){var o=e("./project/project.module"),n=e("./user/user.module");t.exports=angular.module("kanban.admin",[o.name,n.name])},{"./project/project.module":12,"./user/user.module":28}],2:[function(e,t,r){var o=function(e,t){var r=this;r.submit=function(){t.resource("self").save(r.project,function(){e.close()},function(e){r.error=e.data})}};o.$inject=["$uibModalInstance","projects"],t.exports=o},{}],3:[function(e,t,r){var o=function(e,t){var r=this;r.submit=function(){t.resource("category").save(r.category,function(){e.close()},function(e){r.error=e.data})}};o.$inject=["$uibModalInstance","project"],t.exports=o},{}],4:[function(e,t,r){var o=e("./list.controller"),n=e("./add.controller");t.exports=angular.module("kanban.admin.project.category",[]).controller("listCategoryAdminController",o).controller("addCategoryAdminController",n)},{"./add.controller":3,"./list.controller":5}],5:[function(e,t,r){var o=function(e,t){var r=this;r.add=function(){var o=e.open({animation:!0,templateUrl:"templates/admin/project/category/add.html",controller:"addCategoryAdminController",controllerAs:"addCategoryCtrl",resolve:{project:t},size:"md"});o.result.then(function(){r.reload()})},r["delete"]=function(e){e.resource("self")["delete"](null,function(){r.reload()})},r.saveCategory=function(e){var t=e.resource("self").save(e).$promise;return t["catch"](function(e){e.data=e.data.message}),t},r.reload=function(){r.categories=t.resource("category").query()},r.reload()};o.$inject=["$uibModal","project"],t.exports=o},{}],6:[function(e,t,r){var o=function(e,t){var r=this;r.project=t,e.transitionTo("app.project.edit.taskfield",{projectId:t.id})};o.$inject=["$state","project"],t.exports=o},{}],7:[function(e,t,r){var o=function(e,t,r,o){function n(){return r.get({page:a.projects.page.number,size:a.projects.page.size},function(){a.projects._embedded&&angular.forEach(a.projects._embedded.projectResourceList,function(e){return e.states=new o(e).resource("state").query(),e})})}var a=this;a.projects={page:{number:0,size:15}},a.projects=n(),a.add=function(){var r=e.open({animation:!0,templateUrl:"templates/admin/project/add.html",controller:"addProjectAdminController",controllerAs:"addProjectCtrl",resolve:{projects:a.projects},size:"md"});r.result.then(function(){t.$emit("kanban:projects-updates"),a.projects=n()})},a["delete"]=function(e){new o(e).resource("self")["delete"](function(){t.$emit("kanban:projects-updates"),a.projects=n()})}};o.$inject=["$uibModal","$scope","projectService","HateoasInterface"],t.exports=o},{}],8:[function(e,t,r){var o=function(e,t,r){var o=this;o.selectUser=function(e,t,r){o.member.user=t},o.getUsers=function(e){return t.query({search:e}).$promise},o.projectRoles=r.resource("roles").query(),o.submit=function(){r.resource("member").save(o.member,function(){e.close()},function(e){o.error=e.data})}};o.$inject=["$uibModalInstance","userService","project"],t.exports=o},{}],9:[function(e,t,r){var o=function(e,t,r){var o=this;o.projectRoles=t.resource("roles").query(),o.members={page:{number:0,size:15}},o.members=t.resource("member").get({page:o.members.page.number,size:o.members.page.size}),o.add=function(){var r=e.open({animation:!0,templateUrl:"templates/admin/project/member/add.html",controller:"addMemberAdminController",controllerAs:"addMemberCtrl",resolve:{project:t},size:"md"});r.result.then(function(){o.members=t.resource("member").get({page:o.members.page.number,size:o.members.page.size})})},o["delete"]=function(e){new r(e).resource("self")["delete"](null,function(){o.members=t.resource("member").get({page:o.members.page.number,size:o.members.page.size})})},o.saveMember=function(e){var t=new r(e).resource("self").save(e).$promise;return t["catch"](function(e){e.data=e.data.message}),t}};o.$inject=["$uibModal","project","HateoasInterface"],t.exports=o},{}],10:[function(e,t,r){var o=e("./list.controller"),n=e("./add.controller");t.exports=angular.module("kanban.admin.project.member",[]).controller("listMemberAdminController",o).controller("addMemberAdminController",n)},{"./add.controller":8,"./list.controller":9}],11:[function(e,t,r){var o=function(e){e.state("app.projects",{controller:"listProjectAdminController",controllerAs:"projectListAdminCtrl",templateUrl:"templates/admin/project/list.html",url:"project"}),e.state("app.project.edit",{controller:"editProjectAdminController",controllerAs:"projectEditCtrl",templateUrl:"templates/admin/project/project.html",url:"edit"}),e.state("app.project.edit.category",{controller:"listCategoryAdminController",controllerAs:"categoryListCtrl",templateUrl:"templates/admin/project/category/list.html",url:"/category"}),e.state("app.project.edit.swimlane",{controller:"listSwimlaneAdminController",controllerAs:"swimlaneListCtrl",templateUrl:"templates/admin/project/swimlane/list.html",url:"/swimlane"}),e.state("app.project.edit.member",{controller:"listMemberAdminController",controllerAs:"memberListCtrl",templateUrl:"templates/admin/project/member/list.html",url:"/member"}),e.state("app.project.edit.state",{controller:"listStateAdminController",controllerAs:"stateListCtrl",templateUrl:"templates/admin/project/state/list.html",url:"/state"}),e.state("app.project.edit.taskfield",{controller:"listTaskfieldAdminController",controllerAs:"taskfieldListCtrl",templateUrl:"templates/admin/project/taskfield/list.html",url:"/customfield"}),e.state("app.project.edit.taskhisto",{controller:"listTaskHistoAdminController",controllerAs:"taskHistoListCtrl",templateUrl:"templates/admin/project/taskhisto/list.html",url:"/taskHisto"})};o.$inject=["$stateProvider"],t.exports=o},{}],12:[function(e,t,r){var o=e("./state/state.module"),n=e("./category/category.module"),a=e("./swimlane/swimlane.module"),l=e("./member/member.module"),s=e("./taskfield/taskfield.module"),i=e("./taskhisto/taskhisto.module"),c=e("./project.config"),u=e("./list.controller"),d=e("./add.controller"),m=e("./edit.controller");t.exports=angular.module("kanban.admin.project",["kanban.project",o.name,n.name,a.name,l.name,s.name,i.name]).config(c).controller("listProjectAdminController",u).controller("addProjectAdminController",d).controller("editProjectAdminController",m)},{"./add.controller":2,"./category/category.module":4,"./edit.controller":6,"./list.controller":7,"./member/member.module":10,"./project.config":11,"./state/state.module":15,"./swimlane/swimlane.module":18,"./taskfield/taskfield.module":22,"./taskhisto/taskhisto.module":24}],13:[function(e,t,r){var o=function(e,t){var r=this;r.submit=function(){t.resource("state").save(r.state,function(){e.close()},function(e){r.error=e.data})}};o.$inject=["$uibModalInstance","project"],t.exports=o},{}],14:[function(e,t,r){var o=function(e,t,r){var o=this;o.stateListSortOptions={orderChanged:function(e){var t=e.source.itemScope.modelValue,r=e.dest.index;t.position=r,t.resource("self").save(null,t)}},o.add=function(){var r=e.open({animation:!0,templateUrl:"templates/admin/project/state/add.html",controller:"addStateAdminController",controllerAs:"addStateCtrl",resolve:{project:t},size:"md"});r.result.then(function(){o.reload()})},o["delete"]=function(e){e.resource("self")["delete"](null,function(){o.reload()},function(e){r.error(e.data.message)})},o.saveState=function(e){var t=e.resource("self").save(e).$promise;return t["catch"](function(e){e.data=e.data.message}),t},o.reload=function(){o.states=t.resource("state").query()},o.reload()};o.$inject=["$uibModal","project","growl"],t.exports=o},{}],15:[function(e,t,r){var o=e("./list.controller"),n=e("./add.controller");t.exports=angular.module("kanban.admin.project.state",["angular-growl"]).controller("listStateAdminController",o).controller("addStateAdminController",n)},{"./add.controller":13,"./list.controller":14}],16:[function(e,t,r){var o=function(e,t){var r=this;r.submit=function(){t.resource("swimlane").save(r.swimlane,function(){e.close()},function(e){r.error=e.data})}};o.$inject=["$uibModalInstance","project"],t.exports=o},{}],17:[function(e,t,r){var o=function(e,t,r){var o=this;o.swimlaneListSortOptions={orderChanged:function(e){var t=e.source.itemScope.modelValue,r=e.dest.index;t.position=r,t.resource("self").save(null,t)}},o.add=function(){var r=e.open({animation:!0,templateUrl:"templates/admin/project/swimlane/add.html",controller:"addSwimlaneAdminController",controllerAs:"addSwimlaneCtrl",resolve:{project:t},size:"md"});r.result.then(function(){o.reload()})},o["delete"]=function(e){e.resource("self")["delete"](null,function(){o.reload()})},o.saveSwimlane=function(e){var t=e.resource("self").save(e).$promise;return t["catch"](function(e){e.data=e.data.message}),t},o.reload=function(){o.swimlanes=t.resource("swimlane").query(),o.swimlanes.$promise.then(function(e){angular.forEach(e,function(e){e.endPlanned&&(e.endPlanned=r(e.endPlanned).toDate())})})},o.reload()};o.$inject=["$uibModal","project","moment"],t.exports=o},{}],18:[function(e,t,r){var o=e("./list.controller"),n=e("./add.controller");t.exports=angular.module("kanban.admin.project.swimlane",[]).controller("listSwimlaneAdminController",o).controller("addSwimlaneAdminController",n)},{"./add.controller":16,"./list.controller":17}],19:[function(e,t,r){var o=function(e,t,r){var o=this;o.fieldTypes=r.query(),o.submit=function(){t.resource("taskfield").save(o.taskfield,function(){e.close()},function(e){o.error=e.data})}};o.$inject=["$uibModalInstance","project","fieldtypeService"],t.exports=o},{}],20:[function(e,t,r){var o=function(e){return e("/api/taskfieldtype")};o.$inject=["$resource"],t.exports=o},{}],21:[function(e,t,r){var o=function(e,t){var r=this;r.add=function(){var o=e.open({animation:!0,templateUrl:"templates/admin/project/taskfield/add.html",controller:"addTaskfieldAdminController",controllerAs:"addTaskfieldCtrl",resolve:{project:t},size:"md"});o.result.then(function(){r.reload()})},r["delete"]=function(e){e.resource("self")["delete"](null,function(){r.reload()})},r.reload=function(){r.taskfields=t.resource("taskfield").query()},r.reload()};o.$inject=["$uibModal","project"],t.exports=o},{}],22:[function(e,t,r){var o=e("./list.controller"),n=e("./add.controller"),a=e("./fieldtype.service");t.exports=angular.module("kanban.admin.project.taskfield",[]).service("fieldtypeService",a).controller("listTaskfieldAdminController",o).controller("addTaskfieldAdminController",n)},{"./add.controller":19,"./fieldtype.service":20,"./list.controller":21}],23:[function(e,t,r){var o=function(e){var t=this;t.reload=function(){t.taskshisto=e.resource("task").query()},t.reload()};o.$inject=["project"],t.exports=o},{}],24:[function(e,t,r){var o=e("./list.controller");t.exports=angular.module("kanban.admin.project.taskhisto",[]).controller("listTaskHistoAdminController",o)},{"./list.controller":23}],25:[function(e,t,r){var o=function(e,t,r){var o=this;o.roles=t.query(),o.submit=function(){o.error||r.save(o.user,function(){e.close()},function(e){o.error=e.data})}};o.$inject=["$uibModalInstance","userRoleService","userService"],t.exports=o},{}],26:[function(e,t,r){var o=function(e,t,r,o){var n=this;n.users={page:{number:0,size:15}},n.userRoles=o.query(),n.users=r.get({page:n.users.page.number,size:n.users.page.size}),n.add=function(){var t=e.open({animation:!0,templateUrl:"templates/admin/user/add.html",controller:"addUserAdminController",controllerAs:"addUserAdminCtrl",size:"md"});t.result.then(function(){n.users=r.get({page:n.users.page.number,size:n.users.page.size})})},n["delete"]=function(e){new t(e).resource("self")["delete"](null,function(){n.users=r.get({page:n.users.page.number,size:n.users.page.size})})},n.saveUser=function(e){return new t(e).resource("self").save(e).$promise}};o.$inject=["$uibModal","HateoasInterface","userService","userRoleService"],t.exports=o},{}],27:[function(e,t,r){var o=function(e){e.state("app.users",{templateUrl:"templates/admin/user/list.html",controller:"listUserAdminController",controllerAs:"usersCtrl",url:"users"})};o.$inject=["$stateProvider"],t.exports=o},{}],28:[function(e,t,r){var o=e("./user.config"),n=e("./list.controller"),a=e("./add.controller"),l=e("./user.service"),s=e("./userrole.service");t.exports=angular.module("kanban.admin.user",[]).config(o).controller("listUserAdminController",n).controller("addUserAdminController",a).service("userService",l).service("userRoleService",s)},{"./add.controller":25,"./list.controller":26,"./user.config":27,"./user.service":29,"./userrole.service":30}],29:[function(e,t,r){var o=function(e){return e("/api/user")};o.$inject=["$resource"],t.exports=o},{}],30:[function(e,t,r){var o=function(e){return e("/api/role")};o.$inject=["$resource"],t.exports=o},{}],31:[function(e,t,r){function o(e){return{request:function(t){return t.url&&-1===t.url.indexOf(".html")&&e.oauth&&(t.headers.authorization=e.oauth.token_type+" "+e.oauth.access_token,t.withCredentials=!0),t}}}o.$inject=["$sessionStorage"];var n=function(e,t,r){e.state("app",{"abstract":!0,templateUrl:"layout-app.html",controller:"appController",controllerAs:"appCtrl",url:"/",resolve:{currentuser:["currentUserService",function(e){return e.get()}],appParameters:["parameterService",function(e){return e.query()}]}}),e.state("app.dashboard",{templateUrl:"templates/dashboard/dashboard.html",controller:"dashboardController",controllerAs:"dashboardCtrl",url:"dashboard"}),e.state("app.profil",{templateUrl:"templates/profil/profil.html",controller:"profilController",controllerAs:"profilCtrl",url:"profil"}),e.state("login",{templateUrl:"login.html",controller:"loginController",controllerAs:"login",url:"/login"}),t.interceptors.push(o),r.transformAllResponses()};n.$inject=["$stateProvider","$httpProvider","HateoasInterceptorProvider"],t.exports=n},{}],32:[function(e,t,r){var o=function(e,t,r,o,n){var a=this;a.currentuser=t,t.$promise.then(function(){t.projects=t.resource("project").query(),t._links.photo&&e.get(t._links.photo).then(function(e){t.photo=e.data})}),a.redirectTask=function(e,r,o){project=t.resource("project").query({taskId:r.id}).$promise,project.then(function(){n.transitionTo("app.project.task",{projectId:project.$$state.value[0].id,taskId:r.id})}),a.searchedTask=null},a.getTasks=function(e){return t.resource("search").query({search:e}).$promise},a.logout=function(){delete o.oauth,n.transitionTo("login")},r.$on("kanban:projects-updates",function(){t.projects=t.resource("project").query()})};o.$inject=["$http","currentuser","$scope","$sessionStorage","$state"],t.exports=o},{}],33:[function(e,t,r){var o=e("./app.config"),n=e("./app.run"),a=e("./login/login.module"),l=e("./app.controller"),s=e("./dashboard/dashboard.module"),i=e("./project/project.module"),c=e("./directive/samePassword.directive"),u=e("./directive/checkboxfilter.directive"),d=e("./directive/error.directive"),m=e("./directive/toggler.directive"),p=e("./admin/admin.module"),f=e("./profil/profil.controller"),v=e("./parameter/parameter.module");angular.module("kanban",["ui.router","ngStorage","ngSanitize","ui.sortable","angularMoment","http-auth-interceptor","xeditable","ngResource","hateoas","ui.bootstrap","ui.bootstrap.tpls","ngImgCrop","textAngular",a.name,s.name,i.name,p.name,v.name]).config(o).run(n).controller("appController",l).controller("profilController",f).directive("checkboxFilter",u).directive("samePassword",c).directive("errors",d).directive("toggler",m)},{"./admin/admin.module":1,"./app.config":31,"./app.controller":32,"./app.run":34,"./dashboard/dashboard.module":37,"./directive/checkboxfilter.directive":38,"./directive/error.directive":39,"./directive/samePassword.directive":40,"./directive/toggler.directive":41,"./login/login.module":45,"./parameter/parameter.module":49,"./profil/profil.controller":51,"./project/project.module":66}],34:[function(e,t,r){var o=function(e,t,r,o,n,a){a.theme="bs3",e.loginOngoing=!1,e.$on("event:auth-forbidden",function(){r.go("app.dashboard")}),e.$on("event:auth-loginRequired",function(){delete t.oauth;var r=e.$new();e.loginOngoing||(e.loginOngoing=!0,r.modalInstance=o.open({animation:!0,backdrop:"static",templateUrl:"login.html",controller:"loginController",controllerAs:"login",scope:r,keyboard:!1,size:"md"}),r.modalInstance.result.then(function(){n.loginConfirmed(),e.loginOngoing=!1}))}),r.go("login")};o.$inject=["$rootScope","$sessionStorage","$state","$uibModal","authService","editableOptions"],t.exports=o},{}],35:[function(e,t,r){var o=function(e,t,r,o,n){var a=this;a.day=r,a.allocations=t.loadAllocation(n),a.imputations=o.resource("consommation").query({date:1e3*r.format("X")}),a.addTask=function(e,t,r){var o={taskName:t.name,taskId:t.id,timeRemains:t.timeRemains,timeSpent:0},n=!1;angular.forEach(a.imputations,function(e){o.taskId===e.taskId&&(n=!0)}),n||a.imputations.push(o),a.addedTask=null},a.getTasks=function(e){return o.resource("task").query({search:e}).$promise},a.submit=function(){o.resource("consommation").save({date:1e3*r.format("X")},a.imputations,function(){e.close()},function(e){a.error=e.data})}};o.$inject=["$uibModalInstance","allocationService","day","currentuser","appParameters"],t.exports=o},{}],36:[function(e,t,r){var o=function(e,t,r,o,n,a,l){var s=this;s.tasks={page:{size:10,number:1}};var i=function(){r.$promise.then(function(){s.tasks=r.resource("task").get({page:s.tasks.page.number-1,size:s.tasks.page.size},function(e){return e._embedded&&angular.forEach(e._embedded.taskResourceList,function(e){e=o(e),e.project=new t(e).resource("project").get()}),e.page.number++,e}),s.calendarOptions={height:450,editable:!1,lang:"fr",header:{left:"title",center:"",right:"today prev,next"},viewRender:function(e,t){var r=a(e.start),o=a(e.end);s.loadCalendarEvent(1e3*r.format("X"),1e3*o.format("X"))},dayClick:dayOnClick}})};s.loadCalendarEvent=function(e,t){r.resource("task").query({start:e,end:t},function(e){angular.forEach(e,function(e){e=o(e),e.title=e.name,e.start=a(e.plannedStart).toDate(),e.end=a(e.plannedEnding).toDate(),e.allDay=!0,e._links.category?e.category.$promise.then(function(){e.backgroundColor=e.category.bgcolor,n.calendars.userCalendar.fullCalendar("renderEvent",e)}):n.calendars.userCalendar.fullCalendar("renderEvent",e)})})},r.$promise.then(i),dayOnClick=function(t){var o=e.open({animation:!0,templateUrl:"templates/dashboard/calendar/imputation.html",controller:"addImputationController",controllerAs:"addImputationCtrl",resolve:{day:function(){return t},currentuser:function(){return r},appParameters:function(){return l}},size:"md"});o.result.then(i)},s.eventsSource=[]};o.$inject=["$uibModal","HateoasInterface","currentuser","taskAssemblerService","uiCalendarConfig","moment","appParameters"],t.exports=o},{}],37:[function(e,t,r){var o=e("./dashboard.controller"),n=e("./calendar/addimputation.controller");t.exports=angular.module("kanban.dashboard",["ui.calendar"]).controller("dashboardController",o).controller("addImputationController",n)},{"./calendar/addimputation.controller":35,"./dashboard.controller":36}],38:[function(e,t,r){t.exports=function(){return{restrict:"E",transclude:!0,scope:{filterTitle:"@"},template:'<div class="checkboxDropdown"><button class="btn btn-sm" ng-click="toggle()"> {{filterTitle}} <span class="caret"></span></button><div class="checkboxDropdown__filters" ng-class="{\'checkboxDropdown__filters--show\': toggled}"><ng-transclude></ng-transclude></div></div>',link:function(e,t,r){e.toggled=!1,e.toggle=function(){e.toggled=!e.toggled}}}}},{}],39:[function(e,t,r){t.exports=function(){return{restrict:"E",scope:{errors:"=errors"},template:'<ul> <li ng-repeat="msg in errors.messages">{{msg.message}}</li></ul>'}}},{}],40:[function(e,t,r){var o=function(e,t){var r=null;return""!==t&&void 0!==e&&t!==e&&(r={message:"Les mots de passe saisis ne correspondent pas"}),r};t.exports=function(){return{restrict:"E",transclude:!0,scope:{password:"=password",placeholder:"@placeholder",error:"=error"},link:function(e,t,r,n){var a=t.children()[0];t.add(e.password).on("keyup",function(){e.error=o(e.password,a.value),e.$apply()}),e.$watch("password",function(){a.value&&(e.error=o(e.password,a.value))})},template:'<input type="password" class="form-control" id="rePassword" placeholder="{{placeholder}}"/>'}}},{}],41:[function(e,t,r){t.exports=function(){return{restrict:"A",scope:{toggleClass:"@",toggleActive:"="},link:function(e,t){e.toggleActive&&angular.element(t).on("click",function(){angular.element(t).parent().toggleClass(e.toggleClass)})}}}},{}],42:[function(e,t,r){var o=function(e){return{login:function(t){var r={method:"POST",url:"/oauth/token",headers:{Authorization:"Basic "+btoa("clientapp:123456")},withCredentials:!0,params:{username:t.username,password:t.password,grant_type:"password",scope:"read write"}};return e(r)}}};o.$inject=["$http"],t.exports=o},{}],43:[function(e,t,r){var o=function(e){return e("/api/userProfile")};o.$inject=["$resource"],t.exports=o},{}],44:[function(e,t,r){var o=function(e,t,r,o){var n=this;n.authenticate=function(){o.login(n.loginForm).success(function(o){r.oauth=o,e.modalInstance&&e.modalInstance.close(),t.transitionTo("app.dashboard")}).error(function(){n.loginForm={},n.loginForm.error="Login/password invalide"})}};o.$inject=["$scope","$state","$sessionStorage","appAuthService"],t.exports=o},{}],45:[function(e,t,r){var o=e("./login.controller"),n=e("./auth.service"),a=e("./currentuser.service");t.exports=angular.module("kanban.login",[]).controller("loginController",o).service("appAuthService",n).service("currentUserService",a)},{"./auth.service":42,"./currentuser.service":43,"./login.controller":44}],46:[function(e,t,r){var o=function(){return{loadAllocation:function(e){for(var t={},r=0;r<e.length;r++)if("ALLOCATION"===e[r].category){for(var o=0;o<e[r].parameter.length;o++)t[e[r].parameter[o].keyParam]=e[r].parameter[o].valueParam;break}return t}}};o.$inject=[],t.exports=o},{}],47:[function(e,t,r){var o=function(e,t){var r=this;r.saveParameter=function(e){var r=t.save(e).$promise;return r["catch"](function(e){e.data=e.data.message}),r},r.reload=function(){r.parameters=t.query()},r.reload()};o.$inject=["$uibModal","parameterService"],t.exports=o},{}],48:[function(e,t,r){var o=function(e){e.state("app.parameter",{templateUrl:"templates/admin/parameter/list.html",controller:"listParameterAdminController",controllerAs:"parameterCtrl",url:"parameter"})};o.$inject=["$stateProvider"],t.exports=o},{}],49:[function(e,t,r){var o=e("./parameter.config"),n=e("./list.controller"),a=e("./parameter.service"),l=e("./allocation.service");t.exports=angular.module("kanban.parameter",[]).config(o).controller("listParameterAdminController",n).service("parameterService",a).service("allocationService",l)},{"./allocation.service":46,"./list.controller":47,"./parameter.config":48,"./parameter.service":50}],50:[function(e,t,r){var o=function(e){return e("/api/parameter/:category/:key",{category:"@category",key:"@keyParam"})};o.$inject=["$resource"],t.exports=o},{}],51:[function(e,t,r){var o=function(e,t,r){var o=this;o.newPhoto="",r.$promise.then(function(){o.profil=r,r._links.member&&(o.profil.members=r.resource("member").query())});var n=function(t){var r=t.currentTarget.files[0],n=new FileReader;n.onload=function(t){e.$apply(function(){o.photoTemp=t.target.result})},n.readAsDataURL(r)};angular.element(document.querySelector("#photoProfil")).on("change",n),o.save=function(){if(!o.error){var e=new FormData;e.append("id",o.profil.id),void 0!==o.profil.password&&e.append("password",o.profil.password),e.append("email",o.profil.email),e.append("photo",o.newPhoto),t({method:"POST",url:r._links.self,data:e,headers:{"Content-Type":void 0},transformRequest:angular.identity}).then(function(){r.photo=o.newPhoto})}}};o.$inject=["$scope","$http","currentuser"],t.exports=o},{}],52:[function(e,t,r){var o=function(e){e.state("app.project.consommation",{controller:"consommationController",controllerAs:"consommationCtrl",templateUrl:"templates/project/consommation/member.html",url:"consommation"})};o.$inject=["$stateProvider"],t.exports=o},{}],53:[function(e,t,r){function o(e,t){for(var r=[],o=e(t),n=0;7>n;n++)r.push(o),o=e(o).add(1,"days");return r}function n(e,t,r){for(var o=[],n=e(t);n.month()===r;)o.push(n),n=e(n).add(1,"days");return o}var a=function(e,t,r,a,l){var s=this;s.precision="week",s.start=e().startOf("isoWeek"),s.allocations={};var i=e(s.start);s.showDetail=function(e){e.showDetails=!0},s.hideDetail=function(e){e.showDetails=!1},s.precisionChange=function(){s.days=[],"week"===s.precision?(s.start=s.start.startOf("isoWeek"),s.days=o(e,s.start),i=e(s.start).add(8,"days"),s.entries=r.loadConsommations(t,s.start,i),s.entries.$promise.then(function(){r.checkMissingByDay(s.entries,l)})):(s.start=s.start.startOf("month"),s.days=n(e,s.start,s.start.month()),i=e(s.start).add(1,"months"),s.entries=r.loadConsommations(t,s.start,i),s.entries.$promise.then(function(){var e=r.groupByWeek(s.entries,s.days);s.entries=e.entries,s.days=e.weeks}))},s.previous=function(){"week"===s.precision?s.start=s.start.subtract(7,"days"):s.start=s.start.subtract(1,"months"),s.precisionChange()},s.next=function(){"week"===s.precision?s.start=s.start.add(7,"days"):s.start=s.start.add(1,"months"),s.precisionChange()},s.checkAllocation=function(e){return e===s.max.value},s.precisionChange()};a.$inject=["moment","project","consomationService","allocationService","appParameters"],t.exports=a},{}],54:[function(e,t,r){var o=e("./consommation.config"),n=e("./consommation.controller"),a=e("./consommation.service");t.exports=angular.module("kanban.project.consommation",[]).config(o).controller("consommationController",n).service("consomationService",a)},{"./consommation.config":52,"./consommation.controller":53,"./consommation.service":55}],55:[function(e,t,r){function o(e){var t,r=[],o=[],n=0;return angular.forEach(e,function(e){t&&e.week()===t||(t=e.week(),n++),o[n]||(o[n]=[]),o[n].push(e)}),angular.forEach(o,function(e){var t={id:e[0].week(),label:e[0].format("DD/MM")+" au "+e[e.length-1].format("DD/MM"),days:e};r.push(t)}),r}function n(e){var t=e.split("/");try{return new Date(t[1]+"/"+t[0]+"/"+t[2])}catch(r){}}var a=function(e){return{loadConsommations:function(e,t,r){return e.resource("member").query(function(e){angular.forEach(e,function(e){e.imputations=e.resource("imputation").get({start:1e3*t.format("X"),end:1e3*r.format("X")})})})},groupByWeek:function(e,t){var r={weeks:o(t),entries:e};return angular.forEach(e,function(e){e.imputations.$promise.then(function(){var t=[];angular.forEach(r.weeks,function(r){var o=0;angular.forEach(r.days,function(t){o+=e.imputations.imputations[t.format("DD/MM/YYYY")]}),t[r.id]=o}),e.imputations.imputations=t,angular.forEach(e.imputations.details,function(e){var t=[];angular.forEach(r.weeks,function(r){var o=0;angular.forEach(r.days,function(t){o+=e.imputations[t.format("DD/MM/YYYY")]}),t[r.id]=o}),e.imputations=t})})}),r},checkMissingByDay:function(t,r){var o=e.loadAllocation(r);angular.forEach(t,function(e){e.imputations.$promise.then(function(){for(var t=0;t<e.imputations.imputations.length;t++)e.imputations.imputations[t].valImputation!==parseInt(o.max)&&n(e.imputations.imputations[t].imputationDate)<new Date&&(e.imputations.imputations[t].areMissing=!0)})})}}};a.$inject=["allocationService"],t.exports=a},{}],56:[function(e,t,r){var o=function(e,t,r){var o=this;o.addTask=function(){var r=e.open({animation:!0,templateUrl:"templates/project/task/add.html",controller:"addTaskController",controllerAs:"addTaskCtrl",resolve:{project:function(){return t}},size:"md"});r.result.then(function(){})},o.data=r.loadRows(t)};o.$inject=["$uibModal","project","ganttService"],t.exports=o},{}],57:[function(e,t,r){var o=e("./gantt.controller"),n=e("./gantt.service");t.exports=angular.module("kanban.project.gantt",["gantt","gantt.sortable","gantt.movable","gantt.overlap","gantt.dependencies","gantt.tooltips","gantt.bounds","gantt.table","gantt.tree","gantt.groups","gantt.resizeSensor"]).controller("ganttController",o).service("ganttService",n)},{"./gantt.controller":56,"./gantt.service":58}],58:[function(e,t,r){var o=function(e){var t=function(e,t){t.tasks=[];var r=e.resource("task").query({swimlane:t.id});r.$promise.then(function(e){angular.forEach(e,function(e){t.tasks.push(o(e))})})},r=function(e){var t={name:"backlog",tasks:[]},r=e.resource("task").query({noswimlane:!0});return r.$promise.then(function(e){angular.forEach(e,function(e){t.tasks.push(o(e))})}),t},o=function(e){var t=moment(),r=moment();return e.plannedStart&&(t=e.plannedStart),e.plannedEnding&&(r=e.plannedEnding),{id:e.id,name:e.name,from:t,to:r,color:"#0288d1"}};return{loadRows:function(e){var o=[];o.push(r(e));var n=e.resource("swimlane").query();return n.$promise.then(function(r){angular.forEach(r,function(r){o.push(r),t(e,r)})}),o}}};o.$inject=["$q"],t.exports=o},{}],59:[function(e,t,r){var o=function(e,t,r){var o=this,n=function(){o.states=t.resource("state").query({kanban:!0}),o.swimlanes=r.load(t),o.swimlanesToFiltre=o.swimlanes};t.$promise.then(n),o.addTask=function(){var r=e.open({animation:!0,templateUrl:"templates/project/task/add.html",controller:"addTaskController",controllerAs:"addTaskCtrl",resolve:{project:function(){return t}},size:"md"});r.result.then(n)},o.kanbanSortOptions={itemMoved:function(e){var r=e.source.itemScope.modelValue;r.state.id=e.dest.sortableScope.element.attr("data-columnindex");var n=e.dest.sortableScope.element.attr("data-rowindex");n?(r.swimlane||(r.swimlane={}),r.swimlane.id=e.dest.sortableScope.element.attr("data-rowindex")):r.swimlane=null,r.resource("self").save(null,r,function(){o.states=t.resource("state").query({order:"position"})})}},o.resetFilter=function(){o.filter.currentuser=!1,o.filter.urgent=!1}};o.$inject=["$uibModal","project","kanbanService"],t.exports=o},{}],60:[function(e,t,r){var o=e("./kanban.controller"),n=e("./kanban.service"),a=e("./user.filter"),l=e("./urgent.filter");t.exports=angular.module("kanban.project.kanban",[]).controller("kanbanController",o).service("kanbanService",n).filter("currentuserKanbanFilter",a).filter("urgentKanbanFilter",l)},{"./kanban.controller":59,"./kanban.service":61,"./urgent.filter":62,"./user.filter":63}],61:[function(e,t,r){var o=function(e,t){var r=function(e){return angular.forEach(e,function(e){e=t(e)}),e},o=function(e,t,o){var n=[],a=0;return angular.forEach(t,function(t){n[a]={id:t.id},n[a].tasks=e.resource("task").query({swimlane:o,state:t.id},r),a++}),n},n=function(e,t){var o=[],n=0;return angular.forEach(t,function(t){o[n]={id:t.id},o[n].tasks=e.resource("task").query({noswimlane:!0,state:t.id},r),n++}),o};return{load:function(t){var r=[];return t.$promise.then(function(){var a=t.resource("state").query({kanban:!0}),l=t.resource("swimlane").query();e.all([a.$promise,l.$promise]).then(function(e){var a=e[0],l=e[1];angular.forEach(l,function(e){r.push(e),e.states=o(t,a,e.id)});var s={states:a=n(t,a)};r.push(s)})}),r}}};o.$inject=["$q","taskAssemblerService"],t.exports=o},{}],62:[function(e,t,r){function o(){return function(e,t){if(t){for(var r=[],o=0;o<e.length;o++)e[o].urgent&&r.push(e[o]);return r}return e}}t.exports=o},{}],63:[function(e,t,r){function o(e){var t=e.get();return function(e,r){if(r){for(var o=[],n=0;n<e.length;n++)for(var a=0;a<e[n].assignees.length;a++)e[n].assignees[a].userId===t.id&&o.push(e[n]);return o}return e}}o.$inject=["currentUserService"],t.exports=o},{}],64:[function(e,t,r){var o=function(e,t){return t.get({projectId:e.projectId})};o.$inject=["$stateParams","projectService"];var n=function(e,t,r){var o=e.defer();return r.$promise.then(function(){var e="ADMIN"===r.applicationRole;r.resource("member").get({projectId:t.projectId},function(t){var r=t.projectRole,n={
hasAdminRights:e||"MANAGER"===r,hasEditRights:e||"MANAGER"===r||"CONTRIBUTOR"===r,hasReadRights:e||r};o.resolve(n)})}),o.promise};n.$inject=["$q","$stateParams","currentuser"];var a=function(e){e.state("app.project",{"abstract":!0,controller:"projectController",controllerAs:"projectCtrl",templateUrl:"templates/project/layout-single.html",url:"project/:projectId/",resolve:{project:o,userRights:n}}),e.state("app.project.kanban",{templateUrl:"templates/project/kanban/kanban.html",controller:"kanbanController",controllerAs:"kanbanCtrl",url:"kanban"}),e.state("app.project.gantt",{templateUrl:"templates/project/gantt/gantt.html",controller:"ganttController",controllerAs:"ganttCtrl",url:"gantt"})};a.$inject=["$stateProvider"],t.exports=a},{}],65:[function(e,t,r){var o=function(e,t,r){var o=this;o.project=t,r.hasReadRights||e.transitionTo("app.dashboard"),o.rights=r};o.$inject=["$state","project","userRights"],t.exports=o},{}],66:[function(e,t,r){var o=e("./kanban/kanban.module"),n=e("./task/task.module"),a=e("./consommation/consommation.module"),l=e("./gantt/gantt.module"),s=e("./project.config"),i=e("./project.controller"),c=e("./project.service");t.exports=angular.module("kanban.project",[o.name,n.name,a.name,l.name]).config(s).controller("projectController",i).service("projectService",c)},{"./consommation/consommation.module":54,"./gantt/gantt.module":57,"./kanban/kanban.module":60,"./project.config":64,"./project.controller":65,"./project.service":67,"./task/task.module":80}],67:[function(e,t,r){var o=function(e){return e("/api/project/:projectId")};o.$inject=["$resource"],t.exports=o},{}],68:[function(e,t,r){var o=function(e,t){var r=this;r.categories=t.resource("category").query(),r.swimlanes=t.resource("swimlane").query(),r.submit=function(){t.resource("task").save(r.task,function(){e.close()},function(e){r.error=e.data})}};o.$inject=["$uibModalInstance","project"],t.exports=o},{}],69:[function(e,t,r){var o=function(e,t,r){var o=this;o.getMembers=function(e){return r.resource("member").query({search:e}).$promise},o.selectMember=function(e,t,r){o.allocation.member=t},o.submit=function(){t.resource("allocation").save(o.allocation,function(){e.close()},function(e){o.error=e.data})}};o.$inject=["$uibModalInstance","task","project"],t.exports=o},{}],70:[function(e,t,r){var o=e("./list.controller"),n=e("./add.controller");t.exports=angular.module("kanban.project.task.allocation",[]).controller("allocationListController",o).controller("allocationAddController",n)},{"./add.controller":69,"./list.controller":71}],71:[function(e,t,r){var o=function(e,t,r){var o=this;o.add=function(){var n=e.open({animation:!0,templateUrl:"templates/project/task/allocation/add.html",controller:"allocationAddController",controllerAs:"addAllocationCtrl",resolve:{task:function(){return t},project:function(){return r}},size:"xd"});n.result.then(function(){o.allocations=t.resource("allocation").query()})},o["delete"]=function(e){e.resource("self")["delete"](null,function(){o.allocations=t.resource("allocation").query()})},o.allocations=t.allocations=t.resource("allocation").query()};o.$inject=["$uibModal","task","project"],t.exports=o},{}],72:[function(e,t,r){var o=function(e,t,r){var o=this;r.id&&(o.parentComment=r),o.submit=function(){o.parentComment?o.parentComment.resource("reply").save(o.comment,function(){e.close()},function(e){o.error=e.data}):t.resource("comment").save(o.comment,function(){e.close()},function(e){o.error=e.data})}};o.$inject=["$uibModalInstance","task","comment"],t.exports=o},{}],73:[function(e,t,r){var o=e("./list.controller"),n=e("./add.controller"),a=e("./reply.controller");t.exports=angular.module("kanban.project.task.comment",[]).controller("commentListController",o).controller("commentAddController",n).controller("commentReplyController",a)},{"./add.controller":72,"./list.controller":74,"./reply.controller":75}],74:[function(e,t,r){var o=function(e,t){var r=this,o=t.taskCtrl.task;r.add=function(){var t=e.open({animation:!0,templateUrl:"templates/project/task/comment/add.html",controller:"commentAddController",controllerAs:"addCommentCtrl",resolve:{task:function(){return o},comment:{}},size:"md"});t.result.then(function(){r.comments=o.resource("comment").query()})},r.reply=function(t){var n=e.open({animation:!0,templateUrl:"templates/project/task/comment/add.html",controller:"commentAddController",controllerAs:"addCommentCtrl",resolve:{comment:function(){return t},task:function(){return o}},size:"md"});n.result.then(function(){t.showComment=!0,r.selectedComment=t.resource("reply").query()})},r.showHideReply=function(e){e.showComment?e.showComment=!1:(r.selectedComment=e.resource("reply").query(),e.showComment=!0)},r["delete"]=function(e,t){t.resource("self")["delete"](null,function(){null!==e?r.selectedComment=e.resource("reply").query():(r.comments=o.resource("comment").query(),r.selectedComment===t&&(r.selectedComment=null))})},o.$promise.then(function(){r.comments=o.resource("comment").query()})};o.$inject=["$uibModal","$scope"],t.exports=o},{}],75:[function(e,t,r){var o=function(e){var t=this;e.$watch("commentListCtrl.selectedComment",function(e,r){var o=e;o.$promise.then(function(e){t.replies=e})})};o.$inject=["$scope"],t.exports=o},{}],76:[function(e,t,r){var o=function(){};o.$inject=[],t.exports=o},{}],77:[function(e,t,r){var o=function(e,t,r,o){var n=this;n.filter={state:"all",swimlane:"all",category:"all",member:"all"},n.loadPage=function(){t.resource("task").get({page:n.tasks.page.number-1,size:n.tasks.page.size,sort:n.sort.field,sortDirection:n.sort.sortDirection},function(e){e._embedded&&angular.forEach(e._embedded.taskResourceList,r),e.page.number++,n.tasks=e}),n.states=t.resource("state").query(),n.swimlanes=t.resource("swimlane").query(),n.members=t.resource("member").query(),n.categories=t.resource("category").query()},n.tasks={page:{size:10,number:1}},n.sort={field:"name",sortDirection:"desc"},n.loadPage(),n["delete"]=function(e){new o(e).resource("self")["delete"](n.loadPage)},n.addTask=function(){var r=e.open({animation:!0,templateUrl:"templates/project/task/add.html",controller:"addTaskController",controllerAs:"addTaskCtrl",resolve:{project:function(){return t}},size:"md"});r.result.then(n.loadPage)},n.tableFilter=function(e){n.sort.field!==e&&(n.sort.sortDirection=""),n.sort.sortDirection="desc"===n.sort.sortDirection?"asc":"desc",n.sort.field=e,n.loadPage()},n.changedFilter=function(){var e={};"all"!==n.filter.state&&(e.idState=n.filter.state),"all"!==n.filter.swimlane&&(e.idSwimlane=n.filter.swimlane),"all"!==n.filter.member&&(e.idAssignee=n.filter.member),"all"!==n.filter.category&&(e.idCategory=n.filter.category),n.filter.deleted&&(e.deleted=!0),t.resource("task").get({idState:e.idState,idSwimlane:e.idSwimlane,idAssignee:e.idAssignee,idCategory:e.idCategory,deleted:e.deleted,page:n.tasks.page.number-1,size:n.tasks.page.size,sort:n.sort.field,sortDirection:n.sort.sortDirection},function(e){e._embedded&&angular.forEach(e._embedded.taskResourceList,r),e.page.number++,n.tasks=e})},n.resetFilter=function(){n.filter.state="all",n.filter.swimlane="all",n.filter.category="all",n.filter.member="all",n.changedFilter()}};o.$inject=["$uibModal","project","taskAssemblerService","HateoasInterface"],t.exports=o},{}],78:[function(e,t,r){var o=function(e,t){return t.get({projectId:e.projectId,taskId:e.taskId})};o.$inject=["$stateParams","taskService"];var n=function(e){e.state("app.project.tasks",{templateUrl:"templates/project/task/list.html",controller:"tasklistController",controllerAs:"tasksCtrl",url:"tasks"}),e.state("app.project.task",{templateUrl:"templates/project/task/task.html",controller:"taskController",controllerAs:"taskCtrl",resolve:{task:o},url:"task/:taskId"}),e.state("app.project.task.allocation",{templateUrl:"templates/project/task/allocation/list.html",controller:"allocationListController",controllerAs:"allocationListCtrl",url:"/allocation"})};n.$inject=["$stateProvider"],t.exports=n},{}],79:[function(e,t,r){var o=function(e,t,r,o,n,a,l,s){var i=this;i.customFieldMap={},i.task=o,i.allocation=a.loadAllocation(s),r.$promise.then(function(){o.$promise.then(function(){i.task=n(o),i.children=i.task.resource("children").query(),i.parents=i.task.resource("parents").query()}),i.categories=r.resource("category").query(),i.states=r.resource("state").query(),i.swimlanes=r.resource("swimlane").query();var t=r.resource("taskfield").query();e.all([t.$promise,o.$promise]).then(function(e){i.task.customField=[],angular.forEach(e[0],function(e){i.customFieldMap[e.fieldName]={definition:e},i.task.customField.push(i.customFieldMap[e.fieldName])}),i.task.resource("customfield").query(function(e){angular.forEach(e,function(e){"NUMBER"===i.customFieldMap[e.fieldName].definition.type?i.customFieldMap[e.fieldName].fieldValue=parseFloat(e.fieldValue):"DATE"===i.customFieldMap[e.fieldName].definition.type?(i.customFieldMap[e.fieldName].fieldValue=null,null!==e.fieldValue?i.customFieldMap[e.fieldName].fieldValue=new Date(e.fieldValue):i.customFieldMap[e.fieldName].definition.required===!0&&(i.customFieldMap[e.fieldName].fieldValue=new Date)):i.customFieldMap[e.fieldName].fieldValue=e.fieldValue})})})}),i.selectAssignee=function(e,t,r){var o=!1;angular.forEach(i.task.assignees,function(e){e.id===t.id&&(o=!0,l.error("Utilisateur déjà assigné"))}),o||i.task.assignees.push(t)},i.removeuser=function(e){i.task.assignees.splice(e,1)},i.getMembers=function(e){return r.resource("member").query({search:e}).$promise},i.addChild=function(e,t,r){i.task.resource("children").save(e,function(){i.children.push(e)})},i.addParent=function(e,t,r){i.task.resource("parents").save(e,function(){i.parents.push(e)})},i.removeChild=function(e){i.children.splice(e,1)},i.removeParent=function(e){i.parents.splice(e,1)},i.getTasks=function(e){return r.resource("task").query({idTask:i.task.id,search:e}).$promise},i.submit=function(){angular.forEach(i.task.customField,function(e){i.customFieldMap[e.definition.fieldName].value&&(e.value=i.customFieldMap[e.definition.fieldName].value)}),i.task.resource("self").save(i.task,function(){t.transitionTo("app.project.kanban",{projectId:r.id})},function(e){i.error=e.data})}};o.$inject=["$q","$state","project","task","taskAssemblerService","allocationService","growl","appParameters"],t.exports=o},{}],80:[function(e,t,r){var o=e("./comment/comment.module"),n=e("./allocation/allocation.module"),a=e("./task.config"),l=e("./add.controller"),s=e("./list.controller"),i=e("./task.controller"),c=e("./history/history.controller"),u=e("./task.service"),d=e("./taskAssembler.service");t.exports=angular.module("kanban.project.task",[o.name,n.name]).config(a).controller("addTaskController",l).controller("tasklistController",s).controller("taskController",i).controller("historyController",c).service("taskService",u).service("taskAssemblerService",d)},{"./add.controller":68,"./allocation/allocation.module":70,"./comment/comment.module":73,"./history/history.controller":76,"./list.controller":77,"./task.config":78,"./task.controller":79,"./task.service":81,"./taskAssembler.service":82}],81:[function(e,t,r){var o=function(e){return e("/api/project/:projectId/task/:taskId",{projectId:"@projectId",id:"@taskId"})};o.$inject=["$resource"],t.exports=o},{}],82:[function(e,t,r){var o=function(e,t,r){return function(o){var n=o;if(o.resource||(n=new t(o)),o.state=n.resource("state").get(),o._links.category&&(o.category=n.resource("category").get()),o._links.swimlane&&(o.swimlane=n.resource("swimlane").get()),o.assignees=n.resource("assignee").query(function(t){return angular.forEach(t,function(t){t._links.photo&&e.get(t._links.photo).then(function(e){t.photo=e.data}),e.get(t._links.user).then(function(e){t.userId=e.data.id})}),t}),o.exceededLoad=o.timeRemains+o.timeSpent>o.estimatedLoad,null!==n.plannedEnding){var a=r();o.plannedEnding=r(n.plannedEnding).toDate(),o.state.$promise.then(function(){o.exceededDate=a.isAfter(o.plannedEnding,"day")&&!o.state.closeState})}return null!==n.plannedStart&&(o.plannedStart=r(n.plannedStart).toDate()),o}};o.$inject=["$http","HateoasInterface","moment"],t.exports=o},{}]},{},[33]);